#!/usr/bin/env node

const program = require('commander')
const path = require('path')
const fs = require('fs')

program
  .version(JSON.parse(fs.readFileSync(path.join(__dirname, '..', 'package.json'), 'utf8')).version)
  .usage('[options]')
  .option('--tail', 'log streaming mode in 60 sec interval')
  .parse(process.argv)

const run = require("../src/calc").run

function render(obj){
  const str = obj.timestamp+"  "+obj.rates.map(r=> r.name+" "+r.diff+" "+r.vol ).join("  ")
  console.log(str)
}

run().then(obj=>{ render(obj) })
if (program.tail) {
  setInterval(_=>{
    run().then(obj=>{ render(obj) })
  },5000)
}


